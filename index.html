<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <title>Fixed Joystick Cube Rotation</title>
</head>
<body>
  <a-scene vr-mode-ui="enabled: true">
    <!-- Cube -->
    <a-box 
      id="rotatingCube" 
      position="0 1.5 -3" 
      color="blue" 
      depth="1" 
      height="1" 
      width="1">
    </a-box>

    <!-- Camera and Right Controller -->
    <a-entity camera>
      <a-entity 
        id="rightController" 
        oculus-touch-controls="hand: right">
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    const cube = document.querySelector("#rotatingCube");
    let rotation = { x: 0, y: 0, z: 0 }; // Current cube rotation
    let joystickData = { x: 0, y: 0 }; // Joystick state
    let isJoystickActive = false; // Tracks if the joystick is moving

    // Handle joystick movement
    document.querySelector("#rightController").addEventListener("thumbstickmoved", (event) => {
      const { x, y } = event.detail;

      // Update joystick data
      joystickData.x = x;
      joystickData.y = y;

      // Mark joystick as active if it moves out of the center
      isJoystickActive = Math.abs(x) > 0.1 || Math.abs(y) > 0.1;
    });

    // Rotation Loop
    function rotateCube() {
      if (isJoystickActive) {
        // Update cube rotation based on joystick input
        rotation.x += joystickData.y * 2; // Up-down movement
        rotation.y += joystickData.x * 2; // Left-right movement

        // Apply rotation to the cube
        cube.setAttribute("rotation", `${rotation.x} ${rotation.y} ${rotation.z}`);
      }

      // Stop rotation when joystick is centered
      if (Math.abs(joystickData.x) <= 0.1 && Math.abs(joystickData.y) <= 0.1) {
        isJoystickActive = false;
      }

      // Keep the loop running
      requestAnimationFrame(rotateCube);
    }

    // Start rotation loop when scene is loaded
    document.querySelector("a-scene").addEventListener("loaded", () => {
      rotateCube();
    });
  </script>
</body>
</html>
