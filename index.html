<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <title>Smooth Joystick Sphere Rotation</title>
</head>
<body>
  <a-scene vr-mode-ui="enabled: true">
    <!-- Camera Rig -->
    <a-entity id="camera-rig" position="0 1.6 0">
      <!-- Camera -->
      <a-camera>
        <!-- Sphere for 360Â° Image -->
        <a-entity 
          id="rotatingSphere"
          geometry="primitive: sphere; radius: 5000" 
          material="shader: flat; src: 1.JPG; side: back" 
          position="0 0 0">
        </a-entity>
      </a-camera>

      <!-- Right-hand Controller -->
      <a-entity
        id="rightController"
        laser-controls="hand: right"
        raycaster="objects: .clickable"
        thumbstick-moved>
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    // Get the sphere and right controller
    const sphere = document.querySelector("#rotatingSphere");
    const rightController = document.querySelector("#rightController");

    // Variables for rotation, velocity, and joystick input
    let rotation = { x: 0, y: 0, z: 0 };
    let velocity = { x: 0, y: 0 };
    let joystickInput = { x: 0, y: 0 };

    // Listen for thumbstick movement
    rightController.addEventListener("thumbstickmoved", (event) => {
      const { x, y } = event.detail;

      // Update joystick input
      joystickInput.x = x;
      joystickInput.y = y;

      // Scale down the joystick input for reduced speed
      velocity.x = y * 0.5; // Reduced speed for X-axis rotation
      velocity.y = x * 0.5; // Reduced speed for Y-axis rotation
    });

    // Smooth rotation loop
    function updateRotation() {
      // Apply velocity to the rotation values
      rotation.x += velocity.x;
      rotation.y += velocity.y;

      // Update the sphere's rotation
      sphere.setAttribute("rotation", `${rotation.x} ${rotation.y} ${rotation.z}`);

      // Gradually reduce velocity for smooth stopping
      velocity.x *= 0.9; // Dampen X-axis velocity
      velocity.y *= 0.9; // Dampen Y-axis velocity

      // Reset joystick input when velocity is near zero
      if (Math.abs(velocity.x) < 0.01) velocity.x = 0;
      if (Math.abs(velocity.y) < 0.01) velocity.y = 0;

      // Continue the animation loop
      requestAnimationFrame(updateRotation);
    }

    // Start the rotation loop
    updateRotation();
  </script>
</body>
</html>
