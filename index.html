<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebXR Joystick Test</title>
  </head>
  <body>
    <h1>WebXR Joystick Test</h1>
    <p>Move your joystick to see the output below:</p>
    <pre id="output">Awaiting joystick input...</pre>

    <script>
      const output = document.getElementById('output');
      let xrSession = null;

      // Function to log input source data
      function handleInputSources(session) {
        const inputSources = session.inputSources;
        let log = [];
        for (const source of inputSources) {
          if (source.gamepad) {
            const { axes, buttons } = source.gamepad;
            log.push(`Axes: ${axes.map(a => a.toFixed(2)).join(', ')}`);
            log.push(`Buttons: ${buttons.map((b, idx) => `B${idx}: ${b.value.toFixed(2)}`).join(', ')}`);
          }
        }
        output.textContent = log.length ? log.join('\n') : 'No joystick input detected.';
      }

      // Request WebXR session
      navigator.xr.requestSession('immersive-vr').then((session) => {
        xrSession = session;
        output.textContent = 'Session started. Move the joystick!';
        xrSession.addEventListener('inputsourceschange', () => handleInputSources(xrSession));
        xrSession.addEventListener('selectstart', () => output.textContent += '\nSelect started.');
        xrSession.addEventListener('selectend', () => output.textContent += '\nSelect ended.');
      }).catch((err) => {
        output.textContent = 'WebXR session not supported: ' + err.message;
      });
    </script>
  </body>
</html>
